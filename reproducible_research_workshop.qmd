---
title: "Reproducible Research"
subtitle: "Concepts and Tools"
format: 
  revealjs: 
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    editor: visual
---

## Agenda and Goals

-   Project and data organization principles

-   Writing more reusable code

-   A quick tour of tools

-   Playing with Git

-   Data sharing and NIH rules (for Jan 2023 forward)

    ::: aside
    With lots of examples from our lab
    :::

## What do we mean by Reproducible Research?

## Who is this for?

## Reproducibility as a component of Scientific Rigor {.smaller}

For my NIH proposals, I wrote the following text:

> **Scientific rigor and reproducibility:** We have several protocols in place to ensure rigor and reproducibility. In both exposure modeling and epidemiologic analyses, we use careful data cleaning, sanity checks and quality control. These protocols include (1) automated data quality checking using statistical reporting tools and audits; (2) prespecified analytic plans that are approved by the PI with mandated reporting of null results; (3) use of reproducible analytic tools such as R Markdown and Git repositories for statistical code; (4) required verification of analyses by a second data analyst; and (5) adherence to STROBE guidelines[^1] so that results are more likely interpretable and useful to the scientific and policy communities.

[^1]: [Strengthening Reporting in OBservational Epidemiology](https://www.equator-network.org/reporting-guidelines/strobe/)

# Project Organization and Data Management

## Good enough practices - data mgmt

-   Save the raw data.
-   Record all the steps used to process data.
-   Anticipate the need to use multiple data sources, and use a unique identifier for every record.
-   Submit data to a reputable DOI-issuing repository so that others can access and cite it.

::: footer
Publication: [Wilson et al. 2017. Good enough practices in scientific computing. PLoS Computational Biology](https://doi.org/10.1371/journal.pcbi.1005510)
:::

## Good enough practices *-* Software

-   Place a brief explanatory comment at the start of every program.
-   Decompose programs into functions.
-   Give functions and variables meaningful names.
-   Make dependencies and requirements explicit.
-   Do not comment and uncomment sections of code to control a program's behavior.
-   Provide a simple example or test data set.
-   Submit code to a reputable DOI-issuing repository.

::: footer
Publication: [Wilson et al. 2017. Good enough practices in scientific computing. PLoS Computational Biology](https://doi.org/10.1371/journal.pcbi.1005510)
:::

## Good enough practices *-* Collaboration

-   Create an overview of your project.
-   Create a shared "to-do" list for the project.
-   Decide on communication strategies.
-   Make the license explicit.
-   Make the project citable.

::: footer
Publication: [Wilson et al. 2017. Good enough practices in scientific computing. PLoS Computational Biology](https://doi.org/10.1371/journal.pcbi.1005510)
:::

## Good enough practices *-* Project organization 

-   Put each project in its own directory, which is named after the project.
-   Put text documents associated with the project in the doc directory.
-   Put raw data and metadata in a data directory and files generated during cleanup and analysis in a results directory.
-   Put project source code in a designated directory.
-   Name all files to reflect their content or function.

::: footer
Publication: [Wilson et al. 2017. Good enough practices in scientific computing. PLoS Computational Biology](https://doi.org/10.1371/journal.pcbi.1005510)
:::

## Good enough practices *-* Tracking changes

-   Back up (almost) everything created by a human being as soon as it is created.
-   Keep changes small.
-   Share changes frequently.
-   Use a version control system.

::: footer
Publication: [Wilson et al. 2017. Good enough practices in scientific computing. PLoS Computational Biology](https://doi.org/10.1371/journal.pcbi.1005510)
:::

## Checking in on your data stewardship

![](images/horst-seaside-chats.png){fig-alt="cartoon of a group of scientists discussing data with laptop computers and whiteboard"}

::: footer
[Artwork by Dr. Allison Horst](https://github.com/allisonhorst/stats-illustrations#hello)
:::

## Openscapes and the "seaside chat"

Talking about data (analysis and stewardship)!

![](images/openscapes_hex_badge.png){fig-alt="hexagonal badge of the abstract Openscapes logo"}

## Our group check-in (Spring 2022)

![](images/justlab-openscapes-pathway-2022-screenshot.png){fig-alt="screenshot of a busy spreadsheet with notes on reproducibility"}

## Your group check-in

::: {style="text-align: center; margin-top: 2em"}
[Openscapes Template](https://docs.google.com/spreadsheets/d/14D5o9IG3UYmV_kxdUa1bqy1EYBF5iuD2i8b4jL3Tu5c/edit?usp=sharing){preview-link="true" style="text-align: center"}
:::

::: aside
This version is View-only but you can make a copy in Google Docs!
:::

# Version control with *`git`*

## Motivation for using git

::: {style="text-align: center; margin-top: 2em"}
*"yourself from 3 months ago doesn't answer email"*
:::

## Git in RStudio

[Happy Git and and GitHub for the useR](https://happygitwithr.com/)

## Interactive exercise with RStudio Cloud

## Working toward a reproducible toolkit {background="#43464B" background-image="images/pexels-polina-tankilevitch-3872373.jpg" fig-alt="a salad bowl filled with a nice mix of different foods"}

::: aside
[Photo by Polina Tankilevitch from Pexels](https://www.pexels.com/photo/photo-of-sliced-vegetables-on-ceramic-plate-3872373/)
:::

# Examples from our lab

## Analysis of public COVID-19 datasets

-   Complex analysis integrating multiple public data sources

-   Sharing the code plus output increases transparency

::: {style="text-align: center; margin-top: 1em"}
[*Nature Comms* - Rendered markdown with code and output](https://justlab.github.io/COVID_19_admin_disparities/code/NYC_COVID_Disparities.html){preview-link="true" style="text-align: center"}
:::

::: footer
Publication: [Carrión, D., et al. (2021). Neighborhood-level disparities and subway utilization during the COVID-19 pandemic in New York City. *Nature Communications*, 12(1).](https://doi.org/10.1038/s41467-021-24088-7)
:::

## Reproducible simulation

::: {style="text-align: center; margin-top: 2em"}
[Code repository with targets workflow](https://github.com/justlab/casecrossover_preterm_simulation){style="text-align: center"}
:::

::: footer
Publication: [Carrión, D., et al. (2022). The Case--Crossover Design Under Changing Baseline Outcome Risk: A Simulation of Ambient Temperature and Preterm Birth. *Epidemiology*.](https://doi.org/10.1097/EDE.0000000000001477)
:::

## Analysis of data from NIH repositories

::: {style="text-align: center; margin-top: 2em"}
[Zenodo repository for code: DOI 10.5281/zenodo.1172730](https://doi.org/10.5281/zenodo.1172730){style="text-align: center"}
:::

::: footer
Publication: [Heiss, J., Just, A. 2018. Identifying mislabeled and contaminated DNA methylation microarray data: an extended quality control toolset with examples from GEO. *Clin Epigenet*.](https://doi.org/10.1186/s13148-018-0504-1)
:::

# Data sharing

## FAIR principles and data sharing expectations

::: incremental
-   **F**indability
-   **A**ccessibility
-   **I**nteroperability
-   **R**euse of digital assets
:::

## New NIH rules coming Jan 25, 2023

[sharing.nih.gov](https://sharing.nih.gov/)

::: aside
That is 104 days from today -- which is soon
:::

## Publishing reproducible research

## Questions?

email: `allan.just@mssm.edu`

References:

-   Wilson G, Bryan J, Cranston K, Kitzes J, Nederbragt L, Teal TK (2017) Good enough practices in scientific computing. PLoS Comput Biol 13(6): e1005510. <https://doi.org/10.1371/journal.pcbi.1005510>
